#
# Makefile : PMK - Partition Management Kernel
# Generated by XKY Configurator Tool v3.5
#

TARGET_BUILD=../install/pmk
PMK_LIB=../install/pmk/pmk.a

# Makefile Include file
include ../Makefile.inc 

PMK_HEADERS=\
arch/sparc/include/asm_offsets.h\
core/include/printk.h\
core/include/ports_queuing.h\
arch/sparc/include/asm.h\
bsp/sparc/leon3/include/l2cache.h\
arch/sparc/include/cpu.h\
core/include/sharedmemory.h\
arch/sparc/include/sparc.h\
arch/sparc/include/xky_arch.h\
bsp/sparc/leon3/include/irqmp.h\
core/include/barrier.h\
core/include/health_monitor.h\
core/include/xky.h\
core/include/partition.h\
core/include/ipc.h\
bsp/sparc/leon3/include/gaisler.h\
bsp/sparc/leon3/include/amba.h\
core/include/loader.h\
core/include/multicore.h\
bsp/sparc/leon3/include/bsp.h\
bsp/sparc/leon3/include/console.h\
core/include/pmk.h\
core/include/tod.h\
core/include/ports.h\
core/include/devices.h\
core/include/rvs.h\
core/include/segregation.h\
core/include/schedule.h\
core/include/syscall.h\
bsp/sparc/leon3/include/iommu.h\
bsp/sparc/leon3/include/clock.h\
core/include/configurations.h\
core/include/ports_sampling.h\
arch/sparc/include/atomic.h\
core/include/error.h\
core/include/workspace.h

PMK_SOURCES=\
arch/sparc/start.S\
arch/sparc/lock.S\
arch/sparc/segregation_asm.S\
arch/sparc/window.S\
arch/sparc/isr_handler.c\
arch/sparc/isr_handler_asm.S\
arch/sparc/context_switch.S\
arch/sparc/syscall_sparc.S\
arch/sparc/syscall_asm.S\
arch/sparc/syscall_os.c\
arch/sparc/cpu.c\
arch/sparc/isr.c\
arch/sparc/health_monitor.c\
arch/sparc/segregation.c\
arch/sparc/atomic.c\
bsp/sparc/leon3/amba.c\
bsp/sparc/leon3/bsp.c\
bsp/sparc/leon3/clock.c\
bsp/sparc/leon3/console.c\
bsp/sparc/leon3/l2cache.c\
bsp/sparc/leon3/irqmp.c\
bsp/sparc/leon3/bsp_asm.S\
core/error.c\
core/barrier.c\
core/ipc.c\
core/multicore.c\
core/tod.c\
core/init.c\
core/partition.c\
core/segregation.c\
core/schedule.c\
core/health_monitor.c\
core/printk.c\
core/workspace.c\
core/syscalls_tod.c\
core/syscalls_ports.c\
core/syscalls_schedule.c\
core/syscalls_partition.c\
core/syscalls_sharedmemory.c\
core/syscalls_healthmonitor.c\
core/sharedmemory.c\
core/loader.c\
core/ports.c\
core/ports_queuing.c\
core/ports_sampling.c\
core/configurations.c

PMK_OBJECTS=$(patsubst %.c,$(TARGET_BUILD)/%.o,\
            $(patsubst %.S,$(TARGET_BUILD)/%.o,$(PMK_SOURCES)))

TARGET_CPPFLAGS+=\
-DPMK_MAX_CORES=4\
-DPMK_SPARC_LEON4\
-DPMK_PARTITION_BASE_ADDR=0x41000000\
-DPMK_FPU_SUPPORT=1\
-Icore/include\
-Iarch/sparc/include\
-Ibsp/sparc/leon3/include

# All
.PHONY : all
all: $(PMK_LIB)

# Assembly Offsets
.PHONY : arch/sparc/include/asm_offsets.h
arch/sparc/include/asm_offsets.h:
	$(TARGET_CC) $(TARGET_CPPFLAGS) arch/sparc/asm_offsets.c -S -o asm_offsets.s
	/home/ngmp/xky/tools/configurator/utils/asm_offsets.py asm_offsets.s  $@
	@($(RM) asm_offsets.s)

# PMK
$(PMK_LIB): arch/sparc/include/asm_offsets.h $(PMK_OBJECTS) $(PMK_HEADERS)
	$(call make-target-library, $@, $(PMK_OBJECTS))
	@$(foreach obj,$(PMK_HEADERS),$(MKDIR) $(dir ../install/pmk/$(obj));)
	@$(foreach obj,$(PMK_HEADERS),$(CP) $(obj) ../install/pmk/$(obj);)

# LIBXKY

# Clean
.PHONY : clean
clean:
	@($(RM) arch/sparc/include/asm_offsets.h)
	@($(RM) $(TARGET_BUILD))

# Distclean
.PHONY : distclean
distclean:
	@($(RM) arch/sparc/include/asm_offsets.h)
	@($(RM) $(TARGET_BUILD))
	@($(RM) Makefile)

