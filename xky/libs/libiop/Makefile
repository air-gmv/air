#
# Makefile : LIB iop - I/O Partition library
# Generated by XKY Configurator Tool v3.5
#
TARGET_BUILD=../../install/libs/libiop

TARGET_LIBRARY=../../install/libs/libiop/libiop.a

# Makefile Include file
include ../../Makefile.inc 

TARGET_HEADERS=\
include/IOPdriverconfig_interface.h\
include/IOPlibio.h\
include/IOPmilstd_config.h\
include/dispatcher.h\
include/eth_support.h\
include/iop.h\
include/iop_chain.h\
include/iop_error.h\
include/iop_functions.h\
include/iop_headers.h\
include/iop_mms.h\
include/iop_support.h\
drivers/amba/include/ambaext.h\
drivers/greth/include/iop_greth.h\
drivers/gr1553/include/IOPgr1553b.h\
drivers/gr1553/include/IOPgr1553b_config.h\
drivers/gr1553/include/IOPgr1553bc.h\
drivers/gr1553/include/IOPgr1553rt.h\
drivers/grspw/include/IOPgrspw.h\
drivers/mil1553/include/IOPmil1553brm.h\
../../pmk/core/include/xky.h\
../../pmk/arch/sparc/include/xky_arch.h\
../libprintf/include/pprintf.h\
include/debug_functions.h

LIBRARY_HEADERS=\
include/IOPdriverconfig_interface.h\
include/IOPlibio.h\
include/IOPmilstd_config.h\
include/dispatcher.h\
include/eth_support.h\
include/iop.h\
include/iop_chain.h\
include/iop_error.h\
include/iop_functions.h\
include/iop_headers.h\
include/iop_mms.h\
include/iop_support.h\
drivers/amba/include/ambaext.h\
drivers/greth/include/iop_greth.h\
drivers/gr1553/include/IOPgr1553b.h\
drivers/gr1553/include/IOPgr1553b_config.h\
drivers/gr1553/include/IOPgr1553bc.h\
drivers/gr1553/include/IOPgr1553rt.h\
drivers/grspw/include/IOPgrspw.h\
drivers/mil1553/include/IOPmil1553brm.h\

RTEMS_MAKEFILE_PATH=\
../../install/pos/$(RTEMS_DIRECTORY)/$(RTEMS_DIRECTORY)-install/$(RTEMS_TARGET)/$(RTEMS_BSP)
RTEMS_EXTERNAL_LIBRARY_PATH=\
../../install/pos/$(RTEMS_DIRECTORY)/$(RTEMS_EXTERNAL_LIBRARY)

ifneq ($(wildcard $(RTEMS_MAKEFILE_PATH)/Makefile.inc),)

RTEMS_USES_NEWLIB = no

include $(RTEMS_MAKEFILE_PATH)/Makefile.inc
include $(RTEMS_CUSTOM)
include $(PROJECT_ROOT)/make/leaf.cfg

TARGET_CPPFLAGS+=\
-B$(RTEMS_MAKEFILE_PATH)/lib\
-I../../pmk/core/include\
-Idrivers/grspw/include\
-Idrivers/amba/include\
-Idrivers/gr1553/include\
-Idrivers/greth/include\
-I../../pmk/arch/sparc/include\
-Idrivers/mil1553/include\
-Iinclude\
-I../libprintf/include
#-D IOP_NEEDS_DEBUG\

SOURCE_FILES=\
dispatcher.c\
error.c\
eth_support.c\
eth_tasks.c\
init.c\
mms.c\
router.c\
support.c\
drivers/amba/ambaext.c\
drivers/greth/iop_greth.c\
drivers/gr1553/IOPgr1553b.c\
drivers/gr1553/IOPgr1553b_config.c\
drivers/gr1553/IOPgr1553bc.c\
drivers/gr1553/IOPgr1553rt.c\
drivers/grspw/IOPgrspw.c\
drivers/mil1553/IOPmil1553brm.c\
debug_functions.c


OBJECT_FILES=\
$(patsubst %.c,$(TARGET_BUILD)/%.o,\
$(patsubst %.S,$(TARGET_BUILD)/%.o,$(SOURCE_FILES)))

# All
.PHONY : all
all: $(TARGET_LIBRARY)

# Library
$(TARGET_LIBRARY): $(OBJECT_FILES) $(TARGET_HEADERS)
	$(call make-target-library, $@, $(OBJECT_FILES))
	@($(TESTD) ../../install/libs/libiop/include || $(MKDIR) ../../install/libs/libiop/include)
	@$(foreach obj,$(LIBRARY_HEADERS),$(CP) $(obj) ../../install/libs/libiop/include/$(dirname $(obj));)

else

# All
.PHONY : all
all: 
	$(warning RTEMS is missing or not compiled)

endif

# Clean
.PHONY : clean
clean:
	@($(RM) $(TARGET_BUILD))

# Distclean
.PHONY : distclean
distclean: clean
	@($(RM) Makefile)
