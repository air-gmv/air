<!-- Test description file -->
<!-- Test steps must be sequential, starting at 001 -->
<!-- Repetitions are limited to 0xFFF,i.e. 4095		-->
<!-- Major time frame [seconds]						-->
<!-- Test End partition : partition where the test
	 will end and finish - if needed, this can be 
	 adapted										-->
<TDF>
	<!-- Test Definition -->
	<test 	name="TEST-DEF-01561"
			id="1561" 
			partitions="4"
			test_end_partition="0"
			repeat="1" 
			mtf="0.3"
			ms_per_tick="10"
			type="TEST_GMV_VAL"
			personality="RTEMSIMPR"
			apex="IMASPEX">
		<registered_traps async="" sync="0x81" />
		<description>
						Modify TEST-DEF-01560 so that the first three partitions toggle the
			cache status at each Execution window, in the following manner: P1: Toggle
			the code cache status P2: Toggle the data cache status P3: Toggle the
			code and data status P4: Same as P3 but the system calls are not
			authorized. All but P4 shall succeed in changing the cache status and having
			those changes preserved by the partition context switch. P4 shall raise
			health monitor events.
		</description>
		<requirements>
			<req name="AIR_SEP_0930" />	
		</requirements>
		
		<!-- Test Procedure -->
		<testprocedure repeat="3">
			<teststep id="0" partition="0" repeat="1">
				<description>
					Read the cache control register. Verify if the Data cache and the Code Cache are enabled.
				</description>
			</teststep>
			<teststep id="1" partition="0" repeat="1">
				<description>
					Deactivate code cache. Wait for Next MFT
				</description>
			</teststep>
			<teststep id="2" partition="1" repeat="1">
				<description>
					Read the cache control register. Verify if the Data cache and the Code Cache are enabled.
				</description>
			</teststep>
			<teststep id="3" partition="1" repeat="1">
				<description>
					Deactivate data cache. Wait for Next MFT
				</description>
			</teststep>
			<teststep id="4" partition="2" repeat="1">
				<description>
					Read the cache control register. Verify if the Data cache and the Code Cache are enabled.
				</description>
			</teststep>
			<teststep id="5" partition="2" repeat="1">
				<description>
					Deactivate both caches. Wait for Next MFT
				</description>
			</teststep>
			<teststep id="6" partition="3" repeat="1">
				<description>
					Read the cache control register. Verify if the Data cache and the Code Cache are enabled.
				</description>
			</teststep>
			<teststep id="7" partition="3" repeat="1">
				<description>
					Try to deactivate both caches. Verify that a trap was raised and the syscall failed. Wait for Next MFT
				</description>
			</teststep>
			<teststep id="8" partition="0" repeat="1">
				<description>
					Read the cache control register. Verify if data cache is enabled and the code cache is disabled.
				</description>
			</teststep>
			<teststep id="9" partition="0" repeat="1">
				<description>
					Activate code cache. Wait for Next MFT
				</description>
			</teststep>
			<teststep id="10" partition="1" repeat="1">
				<description>
					Read the cache control register. Verify if data cache is enabled and the code cache is disabled.
				</description>
			</teststep>
			<teststep id="11" partition="1" repeat="1">
				<description>
					Activate code cache. Wait for Next MFT
				</description>
			</teststep>
			<teststep id="12" partition="2" repeat="1">
				<description>
					Read the cache control register. Verify that both caches are disabled.
				</description>
			</teststep>
			<teststep id="13" partition="2" repeat="1">
				<description>
					Activate both caches cache. Wait for Next MFT
				</description>
			</teststep>
			<teststep id="14" partition="3" repeat="1">
				<description>
					Read the cache control register. Verify that both caches are enabled since the deactivate failed.
				</description>
			</teststep>
			<teststep id="15" partition="3" repeat="1">
				<description>
					Try to activate both caches. Verify that a trap was raised and the syscall failed. Wait for Next MFT
				</description>
			</teststep>
		</testprocedure>		
	</test>	<!-- Test id="1561" -->
</TDF>