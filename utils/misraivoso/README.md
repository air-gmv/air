# MISRAivoso: Automated MISRA-C Code Correction Tool

MISRAivoso is a powerful Python script designed to facilitate adherence to MISRA-C coding standards by automating code corrections. This tool utilizes the cppcheck static analysis tool to generate an XML report highlighting violations of MISRA-C guidelines. MISRAivoso then rectifies specific rule violations, ensuring code accuracy and maintainability.


## Features

- üöÄ Seamlessly apply MISRA-C coding standards to your C codebase.
- ‚úÖ Correct flagged rule violations from cppcheck analysis.
- üõ†Ô∏è Enhance code quality without compromising functionality.

## Table of Contents

- [Installation](#installation)
- [Usage](#usage)
- [Code Corrections](#code-corrections)
- [Dependencies](#dependencies)
- [Contact](#contact)

## Installation

1. Ensure you have Python 3 and pip installed:
   ```bash
   sudo apt-get update
   sudo apt-get install python3 python3-pip
   ```

2. Install required Python packages:
   ```bash
   pip3 install pygments
   ```

3. Install Tkinter for GUI support:
   ```bash
   sudo apt-get install python3-tk
   ```

4. Install cppcheck:
   ```bash
   sudo apt-get install cppcheck
   ```


5. Install clang-format:
   ```bash
   sudo apt-get install clang-format
   ```

6. Clone the repository and navigate to the project directory:
   ```bash
   git clone https://$(AIR_GIT_REMOTE_HOSTNAME)/AIR/misraivoso.git
   cd misraivoso
   ```

7. Make the script files executable:
   ```bash
   sudo chmod +x MISRAivoso.py
   sudo chmod +x run_cppcheck.py cppcheck-htmlreport.py
   sudo chmod +wx output
   sudo chmod +w output/cppcheck_out.xml
   ```

## Usage

MISRAivoso offers two convenient ways to utilize its code correction capabilities: 
- through the Graphical User Interface (GUI) 
- through the Command Line Interface (CLI). 
Choose the method that best suits your workflow:

### Graphical User Interface (GUI)

1. Execute the script without flags:
   ```bash
   python3 MISRAivoso.py
   ```

2. Choose the directory you want to analyze for MISRA-C guideline violations.

3. Click "Run Check and Report" to initiate the static analysis using cppcheck and generate an XML report (`cppcheck_report.xml`) highlighting the violations.

   The report will also include a detailed `index.html` file in the output directory, containing comprehensive information about the detected MISRA violations. This HTML file provides valuable insights into the violations found, aiding in better understanding the issues.

4. Once the check and report is completed, choose the directory you want to correct (this should be the same directory you selected in the previous step).

5. Choose the output directory where the corrected files will be created.

6. Provide the XML report file generated by the "Check and Report" step (`cppcheck_report.xml`).

7. Click "Run Correction" to initiate the code enhancement process. MISRAivoso will rectify the identified infractions and create a directory with the polished code.

8. To ensure the correctness of the code corrections, navigate to the corrected directory containing the modified files.

9. Click "Run Check and Report" again to generate a new XML report (`cppcheck_report.xml`) for the corrected codebase.

   The HTML report `index.html` will also be regenerated in the output directory, reflecting the updated status of MISRA violations in the corrected codebase.

10. Compare the new report with the previous one to verify that the corrected codebase adheres to MISRA-C guidelines.

11. When running the "Check and Report" is possible to choose two options: 
   - include MISRA comments (comments with the MISRA-C rules that the program did not correct).
   - delete MISRA comments (if previously MISRA comments were added).


### Command Line Interface (CLI)

MISRAivoso also offers a command-line interface for streamlined automated code correction.

1. Run the script with appropriate flags to perform specific actions:
   ```bash
   python3 MISRAivoso.py --cppcheck --correction --src <source_directory> --src-file-list <file_list> [--include-comments] [--delete-comments]
   ```

   Flags:
   - `--cppcheck`: Run the cppcheck analysis to generate an XML report (`cppcheck_out.xml`).
   - `--correction`: Initiate the code correction process.
   - `--src`: Specify the source directory for analysis and correction.
   - `--src-file-list`: Specify a list of individual files (space-separated) inside the source directory to be checked.
   - `--include-comments`: (Optional) Include MISRA comments during correction.
   - `--delete-comments`: (Optional) Delete MISRA comments during correction.

2. If the `--cppcheck` flag is used, the script will perform cppcheck analysis and generate an XML report (`cppcheck_out.xml`) highlighting the detected violations.

3. If the `--correction` flag is used, the identified violations will be rectified, and the corrected files will be saved in the specified output directory.

4. Use `--include-comments` to preserve MISRA comments during correction. These comments provide insights into uncorrected MISRA-C rule violations.

5. Use `--delete-comments` to remove any previously added MISRA comments during correction.

6. If both `--cppcheck` and `--correction` flags are used together, ensure to choose one option as they can't be used simultaneously.

7. If no `--src` or `--src-file-list` flags are provided, the script will prompt you to run the GUI interface. Otherwise, continue with the command-line process.

8. During execution, a progress bar will show the status of the process, providing real-time feedback on the progress.

9. If `--output` is set to "/", the output directory will be the same as where the script is saved.

10. Ensure you have the required dependencies installed before running the script (see the "Dependencies" section in the README).

11. By utilizing the command-line interface, you have the flexibility to perform cppcheck analysis and code correction efficiently, tailored to your specific needs.

Choose the most suitable approach for your workflow, whether through the GUI or the CLI, to ensure a smooth and efficient MISRA-C compliance process.

## Code Corrections

MISRAivoso automates the resolution of several common code issues to ensure adherence to MISRA-C coding standards:

- **Missing Curly Braces:** MISRAivoso identifies instances where curly braces are missing around `if`, `else if`, `else`, `for`, and `while` statements. It automatically adds the necessary braces to improve code readability and maintainability.

- **Single-Variable Conditions:** Corrects `if` and `else if` statements with single-variable conditions by applying appropriate formatting to meet MISRA-C guidelines. This enhances code consistency and ensures compliance with best practices.

- **Void Return Alignment:** Adjusts the alignment of 'void' return statements to adhere to MISRA guidelines. This ensures uniform code structure and improves code aesthetics.

The following code snippets illustrate the correction process applied by MISRAivoso:

## Dependencies

- Python 3
- Required Python packages (pygments)
- Tkinter (for GUI support)
- cppcheck
- clang-format


## Contact

- For inquiries, suggestions, or assistance, don't hesitate to reach me at [miguel.vicente@gmv.com](mailto:miguel.vicente@gmv.com). 
---

**MISRAivoso** - Your Partner for Automated MISRA-C Compliance üõ†Ô∏è
