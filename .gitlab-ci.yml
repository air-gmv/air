# First version for AIR main source code
# Executed in TASTE VM centralized in 192.19.13.167
# author: $(AIR_RUNNER_USER) @GMV 2020

variables:
    GIT_CLEAN_FLAGS: none

default:
    before_script:
        - cd air
        - pwd
        - ls
        - export RTEMS410=/opt/rtems-4.10/bin
        - export AIR=`pwd`
        - export PATH=$PATH:$AIR
        - export PATH=$PATH:$RTEMS410
        - export GIT_SSL_NO_VERIFY=1
        - export AIR_INSTALL=$AIR/install
        - export AIR_PMK=$AIR_INSTALL/pmk
        - export AIR_POS=$AIR_INSTALL/pos
        - export RTEMS_MAKEFILE_PATH=$AIR_POS/rtems5/rtems5-install/sparc-rtems5/leon3
        - export PATH=$PATH:/opt/rtems-5.1-2019.07.25/bin
        - export PATH=$PATH:/home/taste/work/gcc-arm-9.2-2019.12-x86_64-arm-none-eabi/bin
        - export PATH=/opt/rtems-5-arm/bin:$PATH
        - git submodule sync --recursive
        - git submodule update --init --recursive

stages: 
    - sconfig-sparc
    - sbuild-sparc
    - test_0009_sparc
    - sconfig-arm
    - sbuild-arm
    - test_0001_arm

config_sparc:
    stage: sconfig-sparc
    script:
        - cp $AIR/../utils/gitlab-runner/.sparc_config .
        - ./configure -f .sparc_config
        
build_sparc:        
    stage: sbuild-sparc
    script:
        - make clean
        - make
        
config_arm:
    stage: sconfig-arm
    script:
        -  cp $AIR/../utils/gitlab-runner/.arm_config . 
        - ./configure -f .arm_config
        
build_arm:        
    stage: sbuild-arm
    script:
        - make clean
        - make

0009_sparc:
    stage: test_0009_sparc
    script:
        - cd $AIR/examples/validation/TEST-DEF-00009
        - configure
        - make clean
        - make
        - cp $AIR/../utils/gitlab-runner/* .
        - ls
        - ./do_leon4_grmon.sh
        - ./testcheck.py
        - cd $AIR
    environment:
        name: SPARC LEON4

0009_arm:
    stage: test_0001_arm
    script:
        - cd $AIR/examples/arm_unit_tests/lionel
        - configure
        - make clean
        - make
        - cp $AIR/../utils/gitlab-runner/* .
        - ls
        - ./do_zynqz1_qemu.sh
        - ./testcheck.py
        - cd $AIR
    environment:
        name: ARM ZYNQZ1
