#include "iop.h"

#include "partition_defs.h"

#define SRC 0
#define DST 1


rtems_status_code main() {

	uint8_t myip[] = {192,168,0,52};
	uint8_t mymac[] = {0x02,0x8F,0x4F,0xAC,0x27,0xF1};

	uint8_t parserver_ip[] = {192,168,0,1};
	uint8_t parserver_mac[] = {0x00,0x02,0xB3,0xD3,0x16,0x4B};

	char message[] = {
    0x48,0x65,0x6c,0x6c,0x6f,0x21,0x20,0x49,0x73,0x20,0x69,0x74,0x20,0x6d,0x65,
    0x20,0x79,0x6f,0x75,0x27,0x72,0x65,0x20,0x6c,0x6f,0x6f,0x6b,0x69,0x6e,0x67,
    0x20,0x66,0x6f,0x72,0x3f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2e,0x37,0x37,0x6f,0x30,0x55,0x40,0x57,
    0x45,0x53,0x4e,0x57,0x40,0x6d,0x79,0x6f,0x5a,0x3b,0x2c,0x2e,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3b,0x4e,0x40,0x57,0x40,0x40,
    0x40,0x57,0x40,0x57,0x40,0x40,0x40,0x57,0x40,0x57,0x40,0x57,0x40,0x57,0x40,
    0x57,0x40,0x57,0x40,0x40,0x57,0x2c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x40,0x57,0x40,0x57,0x40,0x40,0x40,0x57,0x40,0x57,0x40,0x40,0x40,0x40,0x40,
    0x57,0x40,0x40,0x40,0x57,0x40,0x57,0x40,0x57,0x40,0x40,0x40,0x57,0x40,0x4e,
    0x6f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x41,0x40,0x40,0x40,0x57,0x40,0x57,0x40,0x40,0x40,
    0x57,0x40,0x40,0x40,0x57,0x40,0x40,0x40,0x57,0x40,0x57,0x40,0x57,0x40,0x57,
    0x40,0x57,0x40,0x57,0x40,0x40,0x40,0x40,0x6d,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x6d,0x40,0x57,0x40,
    0x57,0x40,0x57,0x40,0x57,0x40,0x40,0x40,0x57,0x40,0x57,0x40,0x57,0x40,0x57,
    0x40,0x57,0x40,0x57,0x40,0x57,0x40,0x57,0x40,0x57,0x40,0x40,0x40,0x57,0x40,
    0x40,0x40,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0x20,
    0x20,0x3b,0x57,0x40,0x40,0x40,0x57,0x40,0x57,0x40,0x57,0x40,0x40,0x40,0x57,
    0x40,0x40,0x40,0x57,0x40,0x57,0x40,0x40,0x40,0x40,0x40,0x57,0x40,0x57,0x40,
    0x57,0x40,0x40,0x40,0x40,0x40,0x57,0x40,0x57,0x40,0x3a,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x0a,0x20,0x20,0x20,0x20,0x42,0x40,0x40,0x40,0x57,0x40,0x40,
    0x40,0x57,0x40,0x40,0x40,0x57,0x40,0x40,0x40,0x57,0x41,0x57,0x40,0x40,0x42,
    0x37,0x57,0x43,0x44,0x40,0x40,0x32,0x20,0x20,0x53,0x57,0x40,0x57,0x40,0x57,
    0x40,0x40,0x40,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0x20,0x20,
    0x40,0x40,0x40,0x57,0x40,0x40,0x40,0x57,0x40,0x20,0x20,0x20,0x20,0x20,0x20,
    0x2e,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2c,0x20,0x20,
    0x20,0x20,0x40,0x40,0x40,0x57,0x40,0x57,0x40,0x47,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x0a,0x20,0x20,0x20,0x2c,0x57,0x40,0x57,0x40,0x40,0x40,0x40,0x40,
    0x57,0x3b,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x55,0x57,0x40,0x57,0x40,0x57,0x40,
    0x40,0x40,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0x20,0x20,0x40,
    0x57,0x40,0x57,0x40,0x57,0x40,0x57,0x40,0x54,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x40,0x40,0x40,0x57,0x40,0x57,0x40,0x54,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x0a,0x20,0x20,0x20,0x2c,0x57,0x40,0x40,0x40,0x57,0x40,0x57,0x40,0x57,
    0x2c,0x20,0x32,0x47,0x70,0x3b,0x37,0x37,0x2c,0x20,0x20,0x20,0x20,0x20,0x20,
    0x2e,0x43,0x44,0x47,0x44,0x79,0x69,0x20,0x40,0x40,0x57,0x40,0x57,0x40,0x40,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0x20,0x20,0x37,0x57,
    0x40,0x40,0x40,0x57,0x5a,0x4f,0x40,0x20,0x20,0x20,0x54,0x43,0x40,0x57,0x40,
    0x57,0x3a,0x2e,0x20,0x20,0x2e,0x2c,0x79,0x44,0x40,0x57,0x6f,0x4b,0x2e,0x20,
    0x69,0x37,0x63,0x57,0x40,0x40,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x0a,0x20,0x20,0x20,0x20,0x20,0x40,0x57,0x40,0x57,0x40,0x49,0x20,0x43,0x20,
    0x20,0x20,0x20,0x2c,0x37,0x37,0x20,0x2e,0x20,0x3a,0x20,0x20,0x37,0x2e,0x20,
    0x20,0x2e,0x2c,0x20,0x20,0x20,0x20,0x20,0x20,0x40,0x40,0x57,0x40,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x69,
    0x40,0x40,0x57,0x40,0x3b,0x20,0x2e,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x3b,0x2e,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3a,
    0x4b,0x40,0x57,0x40,0x40,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x41,0x40,0x40,0x57,0x40,0x32,0x37,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2e,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x57,0x40,0x57,0x57,0x53,0x69,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x2e,0x57,
    0x40,0x57,0x40,0x57,0x40,0x47,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2c,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x3a,0x20,0x20,0x20,0x20,0x20,0x2e,0x40,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x79,0x57,0x40,0x40,0x40,0x57,0x40,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x37,0x40,0x40,0x40,0x40,0x57,0x40,0x4b,0x3a,0x20,
    0x20,0x20,0x20,0x20,0x47,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x41,0x40,0x57,0x40,0x57,0x40,0x20,0x20,0x20,0x20,0x32,0x40,0x57,0x40,0x40,
    0x47,0x4f,0x42,0x40,0x40,0x57,0x40,0x53,0x20,0x20,0x30,0x6f,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2e,0x20,0x3a,0x37,
    0x20,0x20,0x37,0x4e,0x3b,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x37,0x79,0x3a,
    0x44,0x69,0x2e,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x2e,0x63,0x2c,0x20,0x20,0x20,0x2e,0x20,0x20,
    0x20,0x20,0x2e,0x2e,0x20,0x20,0x2c,0x30,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x3b,0x37,0x20,0x20,0x20,0x20,0x2e,0x2e,0x20,0x20,0x20,0x20,0x3b,0x69,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x37,0x3b,0x2c,0x20,0x20,0x20,
    0x20,0x2e,0x3a,0x79,0x37,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x2e,0x2c,0x3a,0x3b,0x3a,0x3a,0x2c,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x00 };

	char send_msg[256];
	char recv_msg[256];

	int aux = 0;
	int send_length = 0;
	eth_header_t eth_hdr;

	memset((void *)&eth_hdr, 0, sizeof(eth_header_t));
	memcpy(eth_hdr.dest_ip, parserver_ip, 4);
	memcpy(eth_hdr.dest_mac, parserver_mac, 6);
	eth_hdr.dest_port = 17000;
	eth_hdr.source_port = 17000;

	IOPinitialize(myip, mymac);


	while(1) {

		IOPsend(eth_hdr, message, sizeof(message));

		rtems_task_wake_after(1000);
	}
	
	return RTEMS_SUCCESSFUL;

}
